<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quill Auto Blogger API</title>
    <style>
        :root {
            --bg: #0d1117;
            --sidebar: #161b22;
            --panel: #161b22;
            --line: #30363d;
            --text: #f0f6fc;
            --muted: #8b949e;
            --accent: #3fb950;
            /* subtle green accent */
            --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
            --sans: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        body {
            font-family: var(--sans);
            background: var(--bg);
            color: var(--text);
            display: grid;
            grid-template-columns: 220px 1fr 380px;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: sticky;
            top: 0;
            height: 100vh;
            overflow: auto;
            background: var(--sidebar);
            border-right: 1px solid var(--line);
            padding: 20px 14px;
        }

        .brand {
            font-size: 15px;
            font-weight: 800;
            margin-bottom: 18px
        }

        .nav-title {
            font-size: 11px;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: .12em;
            margin: 14px 8px 8px
        }

        .nav-link.active {
            background: #22272e;
            /* subtle neutral highlight */
            color: var(--text);
            font-weight: 600;
            /* slight emphasis instead of color */
            outline: 1px solid rgba(255, 255, 255, .06);
        }

        /* Smaller, tidier logo */
        .brand-logo {
            width: 100%;
            max-width: 72px;
            /* â†“ much smaller logo to match title text size */
            height: auto;
            display: block;
            margin: 4px auto 8px;
            /* centered */
            opacity: .95;
        }

        /* Sidebar links: neutral active state, no green bar */
        .nav-link {
            display: block;
            padding: 8px 10px;
            border-radius: 8px;
            color: var(--text);
            text-decoration: none;
            font-size: 14px;
            border-left: 0;
            /* remove accent bar entirely */
        }

        .nav-link:hover {
            background: #1b1f26;
        }

        /* Optional: tighten sidebar spacing a touch */
        .nav-title {
            margin: 12px 8px 6px;
        }

        .sidebar {
            padding: 18px 12px;
        }

        .github-icon {
            margin-right: 8px;
            vertical-align: middle
        }

        /* Main */
        .main {
            padding: 28px 28px 40px;
            overflow: auto
        }

        .main h1 {
            font-size: 28px;
            margin-bottom: 6px
        }

        .lead {
            color: var(--muted);
            margin-bottom: 20px
        }

        .notes {
            background: #1b1f26;
            border: 1px solid var(--line);
            border-radius: 8px;
            padding: 12px;
            color: var(--muted);
            font-size: 13px;
            font-style: italic;
            margin-bottom: 16px;
        }

        .endpoint {
            padding: 22px 0;
            border-top: 1px solid var(--line)
        }

        .endpoint:first-of-type {
            border-top: none
        }

        .ep-head {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 6px
        }

        .method {
            font-size: 12px;
            font-weight: 800;
            padding: 4px 8px;
            border-radius: 6px;
            text-transform: uppercase
        }

        .GET {
            background: #238636;
            color: #fff;
            border: 1px solid #238636
        }

        .POST {
            background: #cf222e;
            color: #fff;
            border: 1px solid #cf222e
        }

        .path {
            font-family: var(--mono);
            font-size: 14px;
            background: #21262d;
            border: 1px solid var(--line);
            padding: 3px 8px;
            border-radius: 6px
        }

        .desc {
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 10px
        }

        .subttl {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: .14em;
            color: var(--muted);
            margin-top: 12px
        }

        .kv {
            margin-top: 6px
        }

        .kv dt {
            font-size: 13px;
            color: #f0f6fc
        }

        .kv dd {
            font-family: var(--mono);
            font-size: 13px;
            color: #f0f6fc;
            background: #21262d;
            border: 1px solid var(--line);
            border-radius: 6px;
            padding: 6px 8px;
            margin: 6px 0 10px;
            overflow-wrap: anywhere;
            /* wrap long paths/URLs */
        }

        /* Right code panel */
        .panel {
            position: sticky;
            top: 0;
            height: 100vh;
            overflow: auto;
            background: var(--panel);
            border-left: 1px solid var(--line);
            padding: 20px 16px;
        }

        .label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: .14em;
            color: var(--muted);
            margin: 4px 0 8px
        }

        .code {
            position: relative;
            background: #21262d;
            border: 1px solid var(--line);
            border-radius: 8px;
            padding: 12px;
            font-family: var(--mono);
            font-size: 13px;
            color: #f0f6fc;
            line-height: 1.45;
            white-space: pre-wrap;
            /* soft wrap */
            overflow-wrap: anywhere;
            /* break long tokens */
            word-break: break-word;
            margin-bottom: 14px;
        }

        .copy {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 12px;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid var(--line);
            background: #0d1117;
            color: #8b949e;
            cursor: pointer
        }

        /* Responsive */
        @media (max-width:1200px) {
            body {
                grid-template-columns: 220px 1fr
            }

            .panel {
                display: none
            }
        }

        @media (max-width:700px) {
            body {
                grid-template-columns: 1fr
            }

            .sidebar {
                display: none
            }

            .main {
                padding: 22px 16px
            }

            .ep-head {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px
            }

            .path {
                font-size: 13px
            }

            .kv dd {
                font-size: 12px
            }
        }

        a {
            color: #58a6ff
        }
    </style>
</head>

<body>
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="brand">
            <img class="brand-logo" src="https://www.paulchrisluke.com/pcl-labs-logo.svg" alt="PCL Labs">
        </div>

        <div class="nav-title">Blog API</div>
        <a class="nav-link active" href="#ep-blog">/blogs/{date}/API-v3-{date}_digest.json</a>
        <a class="nav-link" href="#ep-blog-markdown">/blogs/{date}/FINAL-{date}_digest.json</a>
        <a class="nav-link" href="#ep-blog-digest">/blogs/{date}/PRE-CLEANED-{date}_digest.json</a>

        <div class="nav-title">Feeds & Discovery</div>
        <a class="nav-link" href="#ep-blogs-index">/blogs/index.json</a>
        <a class="nav-link" href="#ep-rss-feed">/rss.xml</a>
        <a class="nav-link" href="#ep-sitemap">/sitemap.xml</a>

        <div class="nav-title">Stories</div>
        <a class="nav-link" href="#ep-stories">/stories/{date}</a>

        <div class="nav-title">Assets</div>
        <a class="nav-link" href="#ep-assets-stories">/assets/stories/{date}</a>
        <a class="nav-link" href="#ep-assets-story">/assets/stories/{date}/{story_id}</a>
        <a class="nav-link" href="#ep-assets-blog">/assets/blog/{date}</a>
        <a class="nav-link" href="#ep-assets">/assets/*</a>

        <div class="nav-title">Control</div>
        <a class="nav-link" href="#ep-start">/control/record/start</a>
        <a class="nav-link" href="#ep-stop">/control/record/stop</a>

        <div class="nav-title">System</div>
        <a class="nav-link" href="#ep-health">/health</a>

        <div class="nav-title">Links</div>
        <a class="nav-link" href="https://github.com/paulchrisluke/quill-auto-blogger" target="_blank">
            <svg class="github-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path
                    d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.21 11.39.6.11.79-.26.79-.58v-2.23c-3.34.72-4.03-1.42-4.03-1.42-.55-1.39-1.33-1.76-1.33-1.76-1.09-.75.08-.73.08-.73 1.21.08 1.84 1.24 1.84 1.24 1.07 1.83 2.8 1.3 3.49.99.11-.78.42-1.31.76-1.61-2.66-.31-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.12-.3-.53-1.52.12-3.18 0 0 1.01-.32 3.3 1.23.96-.27 1.98-.4 3-.4s2.04.13 3 .4c2.29-1.55 3.3-1.23 3.3-1.23.65 1.66.24 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.8 5.62-5.48 5.93.43.37.83 1.1.83 2.23v3.29c0 .32.19.69.8.58C20.56 21.8 24 17.3 24 12 24 5.37 18.63 0 12 0z" />
            </svg>
            View on GitHub
        </a>
    </aside>

    <!-- MAIN -->
    <main class="main" id="content">
        <h1>API Reference</h1>
        <p class="lead">Complete API for AI-enhanced blog content, story management, and recording control. Serves
            digest data with AI enrichments, structured SEO, and discovery feeds (RSS, sitemap, blogs index).</p>
        <div class="notes"><strong>Pipeline:</strong> PRE-CLEANED (raw) â†’ FINAL (AI-enhanced) â†’ API-v3 (processed). Blog
            endpoints serve different stages of the pipeline. <strong>Domain:</strong> Production endpoints use
            api.paulchrisluke.com, development endpoints use localhost:8000.</div>

        <!-- GET /blogs/{date}/API-v3-{date}_digest.json -->
        <section id="ep-blog" class="endpoint"
            data-curl='curl "https://api.paulchrisluke.com/blogs/2025-08-27/API-v3-2025-08-27_digest.json"' data-json='{
  "version": "3",
  "date": "2025-08-27",
  "twitch_clips": [],
  "github_events": [
    {
      "id": 53966057469,
      "type": "PushEvent",
      "repo": "paulchrisluke/pcl-labs",
      "message": "feat: add new API endpoint"
    }
  ],
  "story_packets": [
    {
      "id": "story_20250827_pr34",
      "title_human": "Shipped: New API Endpoint",
      "ai_micro_intro": "This change enhances the developer experience by providing a cleaner interface for data retrieval.",
      "ai_comprehensive_intro": "In this feature update, we have introduced a new API endpoint that streamlines the process of fetching blog data. This improvement addresses several pain points identified in user feedback and significantly reduces response times."
    }
  ]
}'>
            <div class="ep-head"><span class="method GET">GET</span><span
                    class="path">/blogs/{date}/API-v3-{date}_digest.json</span></div>
            <p class="desc">Retrieve complete AI-enhanced blog data including story packets, GitHub events, and
                AI-generated content. Served directly from R2 bucket via Cloudflare Worker.</p>
            <div class="subttl">Path Parameters</div>
            <dl class="kv">
                <dt>date</dt>
                <dd>string (YYYY-MM-DD)</dd>
            </dl>
            <div class="subttl">Example</div>
            <dl class="kv">
                <dd>/blogs/2025-08-27/API-v3-2025-08-27_digest.json</dd>
            </dl>
        </section>

        <!-- GET /blogs/{date}/FINAL-{date}_digest.json -->
        <section id="ep-blog-markdown" class="endpoint"
            data-curl='curl "https://api.paulchrisluke.com/blogs/2025-08-27/FINAL-2025-08-27_digest.json"' data-json='{
  "version": "3",
  "date": "2025-08-27",
  "markdown": "# Daily Devlog â€” Aug 27, 2025\n\n## Shipped: New API Endpoint\n\nToday we launched a new API endpoint that significantly improves the developer experience. The new blog endpoint provides raw markdown content for easier integration with external tools.\n\n## Key Improvements\n\n- **Faster Response Times**: Reduced from 2.3s to 0.8s average\n- **Cleaner Data Structure**: Simplified JSON response format\n- **Better Error Handling**: More descriptive error messages\n\n## Next Steps\n\nWe are planning to add support for custom date ranges and bulk operations in the next iteration.",
  "story_packets": [...]
}'>
            <div class="ep-head"><span class="method GET">GET</span><span
                    class="path">/blogs/{date}/FINAL-{date}_digest.json</span>
            </div>
            <p class="desc">Get FINAL digest data with AI-enhanced markdown content for a specific date's blog post.
                Served directly from R2 bucket via Cloudflare Worker.</p>
            <div class="subttl">Path Parameters</div>
            <dl class="kv">
                <dt>date</dt>
                <dd>string (YYYY-MM-DD)</dd>
            </dl>
        </section>

        <!-- GET /blogs/{date}/PRE-CLEANED-{date}_digest.json -->
        <section id="ep-blog-digest" class="endpoint"
            data-curl='curl "https://api.paulchrisluke.com/blogs/2025-08-27/PRE-CLEANED-2025-08-27_digest.json"'
            data-json='{
  "version": "3",
  "date": "2025-08-27",
  "story_packets": [
    {
      "id": "story_20250827_pr34",
      "title_human": "Shipped: New API Endpoint",
      "raw_data": "Original unprocessed data from GitHub events and Twitch clips"
    }
  ],
  "github_events": [...],
  "twitch_clips": [...]
}'>
            <div class="ep-head"><span class="method GET">GET</span><span
                    class="path">/blogs/{date}/PRE-CLEANED-{date}_digest.json</span>
            </div>
            <p class="desc">Get raw PRE-CLEANED digest data for a specific date's blog post. Contains unprocessed data
                from GitHub events and Twitch clips. Served directly from R2 bucket via Cloudflare Worker.</p>
            <div class="subttl">Path Parameters</div>
            <dl class="kv">
                <dt>date</dt>
                <dd>string (YYYY-MM-DD)</dd>
            </dl>
        </section>

        <!-- GET /blogs/index.json -->
        <section id="ep-blogs-index" class="endpoint" data-curl='curl "https://api.paulchrisluke.com/blogs/index.json"'
            data-json='{
  "blogs": [
    {
      "id": "blog_20250827",
      "date": "2025-08-27",
      "title": "Daily Devlog â€” Aug 27, 2025",
      "description": "Content here..."
    }
  ]
}'>
            <div class="ep-head"><span class="method GET">GET</span><span class="path">/blogs/index.json</span></div>
            <p class="desc">Get the blogs index listing all available blog posts. Served from Cloudflare Worker with
                enhanced caching.</p>
        </section>

        <!-- GET /rss.xml -->
        <section id="ep-rss-feed" class="endpoint" data-curl='curl "https://api.paulchrisluke.com/rss.xml"' data-json='{
  "feed": {
    "title": "Quill Auto Blogger",
    "description": "AI-enhanced blog posts and stories.",
    "link": "https://api.paulchrisluke.com/rss.xml",
    "items": [...]
  }
}'>
            <div class="ep-head"><span class="method GET">GET</span><span class="path">/rss.xml</span></div>
            <p class="desc">Get the RSS feed for all blog posts. Served from Cloudflare Worker with 24-hour edge
                caching.</p>
        </section>

        <!-- GET /sitemap.xml -->
        <section id="ep-sitemap" class="endpoint" data-curl='curl "https://api.paulchrisluke.com/sitemap.xml"'
            data-json='{
  "sitemap": {
    "urlset": {
      "url": [
        {
          "loc": "https://api.paulchrisluke.com",
          "lastmod": "2025-08-27"
        },
        {
          "loc": "https://api.paulchrisluke.com/blogs/index.json",
          "lastmod": "2025-08-27"
        },
        {
          "loc": "https://api.paulchrisluke.com/blogs/2025-08-27/API-v3-2025-08-27_digest.json",
          "lastmod": "2025-08-27"
        }
      ]
    }
  }
}'>
            <div class="ep-head"><span class="method GET">GET</span><span class="path">/sitemap.xml</span></div>
            <p class="desc">Get the XML sitemap for the entire site. Served from Cloudflare Worker with 24-hour edge
                caching.</p>
        </section>

        <!-- GET /stories/{date} -->
        <section id="ep-stories" class="endpoint" data-curl='curl "http://localhost:8000/stories/2025-08-27"' data-json='{
  "stories": [
    {
      "id": "story_20250827_pr34",
      "title_human": "Shipped: Feature Name"
    }
  ]
}'>
            <div class="ep-head"><span class="method GET">GET</span><span class="path">/stories/{date}</span></div>
            <p class="desc">List story packets for a given date. <strong>Note:</strong> This endpoint is served by the
                local webhook server for development purposes.</p>
            <div class="subttl">Path Parameters</div>
            <dl class="kv">
                <dt>date</dt>
                <dd>string (YYYY-MM-DD)</dd>
            </dl>
        </section>

        <!-- GET /assets/stories/{date} -->
        <section id="ep-assets-stories" class="endpoint"
            data-curl='curl "https://api.paulchrisluke.com/assets/stories/2025/08/27/"' data-json='{
  "assets": [
    "story_20250827_pr34.mp4",
    "story_20250827_pr35.mp4",
    "story_20250827_pr36.mp4",
    "story_20250827_pr34_01_intro.png",
    "story_20250827_pr34_02_why.png",
    "story_20250827_pr34_99_outro.png",
    "story_20250827_pr34_hl_01.png"
  ]
}'>
            <div class="ep-head"><span class="method GET">GET</span><span
                    class="path">/assets/stories/{year}/{month}/{day}/</span>
            </div>
            <p class="desc">List all story assets for a specific date. Served directly from R2 bucket via Cloudflare
                Worker.</p>
            <div class="subttl">Path Parameters</div>
            <dl class="kv">
                <dt>year</dt>
                <dd>string (YYYY)</dd>
                <dt>month</dt>
                <dd>string (MM)</dd>
                <dt>day</dt>
                <dd>string (DD)</dd>
            </dl>
        </section>

        <!-- GET /assets/stories/{year}/{month}/{day}/{story_id} -->
        <section id="ep-assets-story" class="endpoint"
            data-curl='curl "https://api.paulchrisluke.com/assets/stories/2025/08/27/story_20250827_pr34.mp4"'
            data-json='Direct asset serving from R2 bucket'>
            <div class="ep-head"><span class="method GET">GET</span><span
                    class="path">/assets/stories/{year}/{month}/{day}/{filename}</span></div>
            <p class="desc">Get specific story assets (videos, images, thumbnails) for a specific story. Served directly
                from R2 bucket via Cloudflare Worker.</p>
            <div class="subttl">Path Parameters</div>
            <dl class="kv">
                <dt>year</dt>
                <dd>string (YYYY)</dd>
                <dt>month</dt>
                <dd>string (MM)</dd>
                <dt>day</dt>
                <dd>string (DD)</dd>
                <dt>filename</dt>
                <dd>string (asset filename)</dd>
            </dl>
        </section>

        <!-- GET /assets/blog/{date} -->
        <section id="ep-assets-blog" class="endpoint"
            data-curl='curl "https://api.paulchrisluke.com/assets/blog/2025-08-27/"' data-json='{
  "assets": [
    "story_20250827_pr34.mp4",
    "story_20250827_pr34_01_intro.png",
    "story_20250827_pr34_02_why.png"
  ]
}'>
            <div class="ep-head"><span class="method GET">GET</span><span class="path">/assets/blog/{date}/</span>
            </div>
            <p class="desc">Get all assets for a blog post. Served directly from R2 bucket via Cloudflare Worker.</p>
            <div class="subttl">Path Parameters</div>
            <dl class="kv">
                <dt>date</dt>
                <dd>string (YYYY-MM-DD)</dd>
            </dl>
        </section>

        <!-- GET /assets/* -->
        <section id="ep-assets" class="endpoint"
            data-curl='curl "https://api.paulchrisluke.com/assets/stories/2025/08/27/story_20250827_pr34_01_intro.png"'
            data-json='Direct asset serving from R2 bucket'>
            <div class="ep-head"><span class="method GET">GET</span><span class="path">/assets/*</span></div>
            <p class="desc">Serve static assets (images, videos, highlights) directly from R2 bucket via Cloudflare
                Worker.</p>
            <div class="subttl">Example Paths</div>
            <dl class="kv">
                <dt>Story thumbnails</dt>
                <dd>/assets/stories/2025/08/27/story_20250827_pr34_01_intro.png</dd>
                <dt>Video files</dt>
                <dd>/assets/stories/2025/08/27/story_20250827_pr34.mp4</dd>
            </dl>
        </section>

        <!-- POST /control/record/start -->
        <section id="ep-start" class="endpoint" data-curl='curl -X POST "http://localhost:8000/control/record/start" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d ' \''{"story_id":"test_story","bounded":false}'\'' '
      data-json=' {"status":"started","mode":"bounded","story_id":"test_story","prep_delay":5,"duration":15}'>
            <div class="ep-head"><span class="method POST">POST</span><span class="path">/control/record/start</span>
            </div>
            <p class="desc">Start recording for a story (requires token). Supports optional <code
                    style="font-family:var(--mono)">bounded</code> mode. <strong>Note:</strong> This endpoint is served
                by the local webhook server for development purposes.</p>
            <div class="subttl">Headers</div>
            <dl class="kv">
                <dt>Authorization</dt>
                <dd>Bearer &lt;CONTROL_API_TOKEN&gt;</dd>
            </dl>
            <div class="subttl">Request Body</div>
            <dl class="kv">
                <dt>story_id</dt>
                <dd>string</dd>
                <dt>date</dt>
                <dd>string (YYYY-MM-DD, optional)</dd>
                <dt>bounded</dt>
                <dd>boolean (default: false)</dd>
            </dl>
        </section>

        <!-- POST /control/record/stop -->
        <section id="ep-stop" class="endpoint" data-curl='curl -X POST "http://localhost:8000/control/record/stop" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d ' \''{"story_id":"test_story"}'\'' '
      data-json=' {"status":"stopped","story_id":"test_story"}'>
            <div class="ep-head"><span class="method POST">POST</span><span class="path">/control/record/stop</span>
            </div>
            <p class="desc">Stop recording for a story (requires token). <strong>Note:</strong> This endpoint is served
                by the local webhook server for development purposes.</p>
            <div class="subttl">Headers</div>
            <dl class="kv">
                <dt>Authorization</dt>
                <dd>Bearer &lt;CONTROL_API_TOKEN&gt;</dd>
            </dl>
            <div class="subttl">Request Body</div>
            <dl class="kv">
                <dt>story_id</dt>
                <dd>string</dd>
                <dt>date</dt>
                <dd>string (YYYY-MM-DD, optional)</dd>
            </dl>
        </section>

        <!-- GET /health -->
        <section id="ep-health" class="endpoint" data-curl='curl "http://localhost:8000/health"' data-json='{
  "status": "healthy",
  "timestamp": "2025-08-27T12:00:00Z"
}'>
            <div class="ep-head"><span class="method GET">GET</span><span class="path">/health</span></div>
            <p class="desc">Health check endpoint for monitoring system status. <strong>Note:</strong> This endpoint is
                served by the local webhook server for development purposes.</p>
        </section>
    </main>

    <!-- CODE PANEL -->
    <aside class="panel">
        <div class="label">cURL</div>
        <div class="code" id="code-curl"><button class="copy">Copy</button>
            curl "https://api.paulchrisluke.com/blogs/2025-08-27/API-v3-2025-08-27_digest.json"
        </div>
        <div class="label">200 Example</div>
        <div class="code" id="code-json"><button class="copy">Copy</button>
            {
            "version": "3",
            "date": "2025-08-27",
            "github_events": [
            {
            "id": 53966057469,
            "type": "PushEvent",
            "repo": "paulchrisluke/pcl-labs",
            "message": "feat: add new API endpoint"
            }
            ],
            "story_packets": [
            {
            "id": "story_20250827_pr34",
            "title_human": "Shipped: New API Endpoint",
            "ai_micro_intro": "This change enhances the developer experience by providing a cleaner interface for data
            retrieval.",
            "ai_comprehensive_intro": "In this feature update, we have introduced a new API endpoint that streamlines
            the process of fetching blog data. This improvement addresses several pain points identified in user
            feedback and significantly reduces response times."
            }
            ]
            }
        </div>
    </aside>

    <script>
        // Elements
        const sections = [...document.querySelectorAll('.endpoint')];
        const sidebarLinks = [...document.querySelectorAll('.nav-link')];
        const curlEl = document.getElementById('code-curl');
        const jsonEl = document.getElementById('code-json');

        function setBlock(blockEl, text) {
            const btn = blockEl.querySelector('.copy');
            blockEl.textContent = '\n' + (text || '');
            if (btn) blockEl.prepend(btn);
        }

        function setExamplesFrom(el) {
            setBlock(curlEl, el.getAttribute('data-curl'));
            setBlock(jsonEl, el.getAttribute('data-json'));
            const id = '#' + el.id;

            // Update sidebar active state
            sidebarLinks.forEach(a => a.classList.toggle('active', a.getAttribute('href') === id));

            // Update URL hash without triggering scroll
            if (window.location.hash !== id) {
                history.replaceState(null, null, id);
            }
        }

        function navigateToSection(id, scroll = true) {
            const target = document.getElementById(id);
            if (target) {
                setExamplesFrom(target);
                if (scroll) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        }

        // Sidebar clicks
        sidebarLinks.forEach(a => {
            a.addEventListener('click', e => {
                const id = a.getAttribute('href').slice(1);
                e.preventDefault();
                navigateToSection(id);
            });
        });

        // Enhanced scroll spy with better threshold and debouncing
        let scrollTimeout;
        const spy = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    // Debounce scroll events to prevent rapid updates
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        setExamplesFrom(entry.target);
                    }, 50);
                }
            });
        }, {
            root: document.querySelector('.main'),
            threshold: 0.3,
            rootMargin: '-20px 0px -20px 0px'
        });

        sections.forEach(s => spy.observe(s));

        // Handle initial load and URL hash
        function initializePage() {
            const hash = window.location.hash;
            if (hash) {
                const id = hash.slice(1);
                navigateToSection(id, false);
            } else {
                setExamplesFrom(document.getElementById('ep-blog'));
            }
        }

        // Copy buttons
        document.querySelectorAll('.code .copy').forEach(btn => {
            btn.addEventListener('click', () => {
                const parent = btn.parentElement;
                const text = parent.textContent.replace('Copy', '').trim();
                navigator.clipboard.writeText(text);
                const old = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = old, 1100);
            });
        });

        // Initialize page
        initializePage();
    </script>
</body>

</html>